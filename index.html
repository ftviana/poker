<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contagem de Poker</title>
    <style>
      body {
        font-family: sans-serif;
        background: #f2f2f2;
        margin: 0;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      h1 {
        margin-bottom: 1rem;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        max-width: 600px;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      th,
      td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      input[type="text"],
      input[type="number"] {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type="number"] {
        -moz-appearance: textfield;
      }
      tfoot td {
        font-weight: bold;
      }
      .controls {
        margin-top: 1rem;
        display: flex;
        gap: 1rem;
      }
      button {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        background-color: #007bff;
        color: white;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <h1>Contagem de Poker</h1>
    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody id="player-table">
        <!-- Gerado por JS -->
      </tbody>
      <tfoot>
        <tr>
          <td>Total Positivo</td>
          <td id="total-positivo">0</td>
        </tr>
        <tr>
          <td>Total Negativo</td>
          <td id="total-negativo">0</td>
        </tr>
        <tr>
          <td>Total Diferença</td>
          <td id="total-diferenca">0</td>
        </tr>
      </tfoot>
    </table>

    <div class="controls">
      <button onclick="resetTable()">Limpar</button>
      <button onclick="undo()">⟲ Desfazer</button>
      <button onclick="redo()">⟳ Refazer</button>
    </div>

    <script>
      const tableBody = document.getElementById("player-table");
      const history = [];
      let historyIndex = -1;

      function createRow(index) {
        const tr = document.createElement("tr");

        const tdNome = document.createElement("td");
        const inputNome = document.createElement("input");
        inputNome.type = "text";
        inputNome.placeholder = `Jogador ${index + 1}`;
        inputNome.oninput = () => {
          saveState();
          updateTotals();
        };
        tdNome.appendChild(inputNome);

        const tdBalance = document.createElement("td");
        const inputBalance = document.createElement("input");
        inputBalance.type = "number";
        inputBalance.inputMode = "decimal";
        inputBalance.value = "";
        inputBalance.oninput = () => {
          saveState();
          updateTotals();
        };
        tdBalance.appendChild(inputBalance);

        tr.appendChild(tdNome);
        tr.appendChild(tdBalance);

        return tr;
      }

      function updateTotals() {
        const inputs = tableBody.querySelectorAll('input[type="number"]');
        let totalPositivo = 0;
        let totalNegativo = 0;

        inputs.forEach((input) => {
          const val = parseFloat(input.value);
          if (!isNaN(val)) {
            if (val > 0) totalPositivo += val;
            else totalNegativo += val;
          }
        });

        document.getElementById("total-positivo").textContent =
          totalPositivo.toFixed(2);
        document.getElementById("total-negativo").textContent =
          totalNegativo.toFixed(2);
        document.getElementById("total-diferenca").textContent = (
          totalPositivo + totalNegativo
        ).toFixed(2);

        saveToLocal();
      }

      function resetTable() {
        const inputs = tableBody.querySelectorAll("input");
        inputs.forEach((input) => (input.value = ""));
        saveState();
        updateTotals();
      }

      function saveState() {
        const state = Array.from(tableBody.querySelectorAll("tr")).map((tr) => {
          const inputs = tr.querySelectorAll("input");
          return {
            nome: inputs[0].value,
            balance: inputs[1].value,
          };
        });

        history.splice(historyIndex + 1);
        history.push(JSON.stringify(state));
        historyIndex++;
      }

      function applyState(stateJSON) {
        const state = JSON.parse(stateJSON);
        state.forEach((row, i) => {
          const tr = tableBody.children[i];
          const inputs = tr.querySelectorAll("input");
          inputs[0].value = row.nome;
          inputs[1].value = row.balance;
        });
        updateTotals();
      }

      function undo() {
        if (historyIndex > 0) {
          historyIndex--;
          applyState(history[historyIndex]);
        }
      }

      function redo() {
        if (historyIndex < history.length - 1) {
          historyIndex++;
          applyState(history[historyIndex]);
        }
      }

      function saveToLocal() {
        const current = Array.from(tableBody.querySelectorAll("tr")).map(
          (tr) => {
            const inputs = tr.querySelectorAll("input");
            return {
              nome: inputs[0].value,
              balance: inputs[1].value,
            };
          }
        );
        localStorage.setItem("poker_tracker", JSON.stringify(current));
      }

      function loadFromLocal() {
        const saved = localStorage.getItem("poker_tracker");
        if (saved) {
          const state = JSON.parse(saved);
          state.forEach((row, i) => {
            const tr = tableBody.children[i];
            const inputs = tr.querySelectorAll("input");
            inputs[0].value = row.nome;
            inputs[1].value = row.balance;
          });
          saveState();
          updateTotals();
        }
      }

      // Inicializar com 8 jogadores
      for (let i = 0; i < 8; i++) {
        tableBody.appendChild(createRow(i));
      }
      loadFromLocal();

      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.key === "z" && !e.shiftKey) {
          e.preventDefault();
          undo();
        } else if (
          (e.ctrlKey || e.metaKey) &&
          e.shiftKey &&
          e.key.toLowerCase() === "z"
        ) {
          e.preventDefault();
          redo();
        }
      });
    </script>
  </body>
</html>
